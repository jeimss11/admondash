<h2 mat-dialog-title>Receipts Printing</h2>

<mat-dialog-content class="venta-modal-content">
	<div class="venta-modal-fixed">
		<!-- Sección PRODUCTOS -->
		<div class="products-section">
			<mat-form-field appearance="outline" class="product-select">
				<mat-label>Select a product...</mat-label>
				<mat-select
					[(ngModel)]="productoSeleccionado"
					(selectionChange)="onProductoChange()"
					name="producto"
				>
					<mat-option *ngFor="let p of productosFiltrados" [value]="p">
						<span
							style="
								display: flex;
								align-items: center;
								justify-content: space-between;
								width: 100%;
							"
						>
							<span style="font-weight: 500; text-align: left; flex-shrink: 0">{{ p.nombre }}</span>
							<span style="flex: 1 1 auto"></span>
							<span
								style="
									color: #888;
									font-size: 0.95em;
									min-width: 70px;
									text-align: right;
									flex-shrink: 0;
								"
								>Stock: {{ p.stock }}</span
							>
						</span>
					</mat-option>
				</mat-select>
			</mat-form-field>
		</div>

		<!-- Campos de búsqueda y detalles -->
		<div class="search-section">
			<mat-form-field appearance="outline" class="product-search" floatLabel="always">
				<mat-label>Product</mat-label>
				<input
					type="text"
					matInput
					[matAutocomplete]="auto"
					[(ngModel)]="busquedaProducto"
					(ngModelChange)="filtrarProductos($event)"
					name="busqueda"
				/>
				<mat-icon matSuffix>search</mat-icon>
				<mat-autocomplete
					#auto="matAutocomplete"
					(optionSelected)="seleccionarProducto($event.option.value)"
				>
					<mat-option *ngFor="let p of productosFiltrados" [value]="p.nombre">
						<span
							style="
								display: flex;
								align-items: center;
								justify-content: space-between;
								width: 100%;
							"
						>
							<span style="font-weight: 500; text-align: left; flex-shrink: 0">{{ p.nombre }}</span>
							<span style="flex: 1 1 auto"></span>
							<span
								style="
									color: #888;
									font-size: 0.95em;
									min-width: 70px;
									text-align: right;
									flex-shrink: 0;
								"
								>Stock: {{ p.stock }}</span
							>
						</span>
					</mat-option>
				</mat-autocomplete>
			</mat-form-field>
		</div>

		<!-- Fila de campos Price, Quantity, Total -->
		<div class="details-row">
			<mat-form-field appearance="outline">
				<mat-label>Price</mat-label>
				<input matInput [value]="precio" readonly />
			</mat-form-field>
			<mat-form-field appearance="outline">
				<mat-label>Quantity</mat-label>
				<input
					matInput
					type="number"
					min="1"
					[(ngModel)]="cantidad"
					(ngModelChange)="onCantidadChange()"
					name="cantidad"
				/>
			</mat-form-field>
			<mat-form-field appearance="outline">
				<mat-label>Total</mat-label>
				<input matInput [value]="total" readonly />
			</mat-form-field>
		</div>

		<!-- Fila de Receipt y Client name -->
		<div class="receipt-row">
			<mat-form-field appearance="outline" class="receipt-number">
				<mat-label># Receipt</mat-label>
				<input matInput value="0" readonly />
			</mat-form-field>
			<mat-form-field appearance="outline" class="client-field">
				<mat-label>Client name</mat-label>
				<mat-select [(ngModel)]="clienteSeleccionado" name="cliente">
					<mat-option [value]="null">Sin cliente</mat-option>
					<mat-option *ngFor="let c of clientes" [value]="c">{{ c.nombre }}</mat-option>
				</mat-select>
			</mat-form-field>
			<button
				mat-fab
				color="primary"
				class="add-cart-button"
				(click)="agregarProducto()"
				[disabled]="!productoSeleccionado || !cantidad"
			>
				<mat-icon>shopping_cart</mat-icon>
			</button>
		</div>
	</div>

	<!-- Tabla de productos scrollable -->
	<div class="table-container-scroll">
		<table class="product-table">
			<thead>
				<tr>
					<th>Product</th>
					<th>Quantity</th>
					<th>Price</th>
					<th>Total</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr *ngFor="let p of productosVenta; let i = index">
					<td>{{ p.nombre }}</td>
					<td>{{ p.cantidad }}</td>
					<td>{{ p.precio | currency : 'USD' : 'symbol' : '1.0-0' }}</td>
					<td>{{ p.total | currency : 'USD' : 'symbol' : '1.0-0' }}</td>
					<td>
						<button mat-icon-button color="warn" (click)="eliminarProducto(i)">
							<mat-icon>delete</mat-icon>
						</button>
					</td>
				</tr>
			</tbody>
		</table>
	</div>

	<!-- Resumen de totales -->
	<div class="totals-section">
		<div class="total-line">Subtotal: {{ subtotal | currency : 'USD' : 'symbol' : '1.0-0' }}</div>
		<div class="total-line">Discount: {{ descuento | currency : 'USD' : 'symbol' : '1.0-0' }}</div>
		<div class="total-final">Total: {{ totalFinal | currency : 'USD' : 'symbol' : '1.0-0' }}</div>
	</div>
</mat-dialog-content>

<mat-dialog-actions>
	<button mat-raised-button color="accent" class="action-button" (click)="imprimir()">PRINT</button>
	<button mat-raised-button color="primary" class="action-button" (click)="descontar()">
		DISCOUNT
	</button>
	<button
		mat-raised-button
		color="primary"
		class="action-button"
		(click)="guardarVenta()"
		[disabled]="productosVenta.length === 0"
	>
		SAVE
	</button>
</mat-dialog-actions>
