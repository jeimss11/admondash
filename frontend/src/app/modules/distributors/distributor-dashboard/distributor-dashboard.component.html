<div class="dashboard-container">
  <div class="header-section">
    <button class="btn btn-secondary mb-3" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Volver a Distribuidores
    </button>

    <div class="distributor-info">
      <h2>{{ distributor?.name }}</h2>
      <p class="contact-info">Contacto: {{ distributor?.contact }}</p>
      <span class="status-badge" [class.active]="distributor?.status === 'Activo'">
        {{ distributor?.status }}
      </span>
    </div>
  </div>

  <!-- Estadísticas resumen -->
  <div class="stats-section">
    <div class="row">
      <div class="col-md-3">
        <div class="stat-card">
          <h4>Ventas del Día</h4>
          <p class="stat-value">{{ salesData.today | currency }}</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card">
          <h4>Ventas del Mes</h4>
          <p class="stat-value">{{ salesData.month | currency }}</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card">
          <h4>Facturas Pendientes</h4>
          <p class="stat-value">{{ salesData.pendingInvoices }}</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card">
          <h4>Productos Vendidos</h4>
          <p class="stat-value">{{ salesData.productsSold }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Pestañas -->
  <div class="tabs-section">
    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a
          class="nav-link"
          [class.active]="activeTab === 'ventas'"
          (click)="setActiveTab('ventas')"
          href="javascript:void(0)"
        >
          Ventas
        </a>
      </li>
      <li class="nav-item">
        <a
          class="nav-link"
          [class.active]="activeTab === 'abrir-dia'"
          (click)="setActiveTab('abrir-dia')"
          href="javascript:void(0)"
        >
          Abrir Día
        </a>
      </li>
      <li class="nav-item">
        <a
          class="nav-link"
          [class.active]="activeTab === 'facturas'"
          (click)="setActiveTab('facturas')"
          href="javascript:void(0)"
        >
          Facturas Pendientes
        </a>
      </li>
    </ul>

    <div class="tab-content">
      <!-- Pestaña Ventas -->
      <div *ngIf="activeTab === 'ventas'" class="tab-pane active">
        <div class="row">
          <div class="col-md-8">
            <div class="chart-container">
              <h4>Gráfico de Ventas (Últimos 7 días)</h4>
              <canvas id="salesChart"></canvas>
            </div>
          </div>
          <div class="col-md-4">
            <div class="chart-container">
              <h4>Distribución de Productos</h4>
              <canvas id="productsChart"></canvas>
            </div>
          </div>
        </div>

        <div class="sales-table mt-4">
          <h4>Historial de Ventas</h4>
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio Unitario</th>
                <th>Total</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>2025-09-11</td>
                <td>Producto A</td>
                <td>5</td>
                <td>$10.00</td>
                <td>$50.00</td>
                <td><span class="badge bg-success">Completada</span></td>
              </tr>
              <tr>
                <td>2025-09-10</td>
                <td>Producto B</td>
                <td>3</td>
                <td>$15.00</td>
                <td>$45.00</td>
                <td><span class="badge bg-warning">Pendiente</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Pestaña Abrir Día -->
      <div *ngIf="activeTab === 'abrir-dia'" class="tab-pane active">
        <div class="open-day-container">
          <!-- Selector de Fecha -->
          <div class="date-selector mb-4">
            <h5>Seleccionar Fecha</h5>
            <input
              type="date"
              class="form-control"
              [(ngModel)]="selectedDate"
              (change)="loadDayData()"
            />
          </div>

          <!-- Productos Iniciales -->
          <div class="initial-products mb-4">
            <h5>Productos Iniciales del Día</h5>
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Producto</th>
                    <th>Cantidad Inicial</th>
                    <th>Precio Unitario</th>
                    <th>Valor Total</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let product of initialProducts">
                    <td>{{ product.name }}</td>
                    <td>{{ product.initialQuantity }}</td>
                    <td>{{ product.unitPrice | currency }}</td>
                    <td>{{ product.initialQuantity * product.unitPrice | currency }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Formulario para Agregar Productos Vendidos -->
          <div class="add-product-form mb-4">
            <h5>Agregar Producto Vendido</h5>
            <form (ngSubmit)="addSoldProduct()" #productForm="ngForm">
              <div class="row">
                <div class="col-md-4">
                  <select
                    class="form-control"
                    [(ngModel)]="newSoldProduct.productId"
                    name="productId"
                    required
                  >
                    <option value="">Seleccionar Producto</option>
                    <option *ngFor="let product of availableProducts" [value]="product.id">
                      {{ product.name }}
                    </option>
                  </select>
                </div>
                <div class="col-md-3">
                  <input
                    type="number"
                    class="form-control"
                    [(ngModel)]="newSoldProduct.quantity"
                    name="quantity"
                    placeholder="Cantidad"
                    min="1"
                    required
                  />
                </div>
                <div class="col-md-3">
                  <input
                    type="number"
                    class="form-control"
                    [(ngModel)]="newSoldProduct.unitPrice"
                    name="unitPrice"
                    placeholder="Precio Unitario"
                    step="0.01"
                    min="0"
                    required
                  />
                </div>
                <div class="col-md-2">
                  <button
                    type="submit"
                    class="btn btn-success w-100"
                    [disabled]="!productForm.form.valid"
                  >
                    Agregar
                  </button>
                </div>
              </div>
            </form>
          </div>

          <!-- Tabla de Productos Vendidos -->
          <div class="sold-products mb-4">
            <h5>Productos Vendidos Hoy</h5>
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Precio Unitario</th>
                    <th>Total</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let soldProduct of soldProducts; let i = index">
                    <td>{{ soldProduct.productName }}</td>
                    <td>{{ soldProduct.quantity }}</td>
                    <td>{{ soldProduct.unitPrice | currency }}</td>
                    <td>{{ soldProduct.total | currency }}</td>
                    <td>
                      <button class="btn btn-danger btn-sm" (click)="removeSoldProduct(i)">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Resumen Financiero -->
          <div class="financial-summary mb-4">
            <h5>Resumen Financiero</h5>
            <div class="row">
              <div class="col-md-3">
                <div class="summary-card">
                  <h6>Total Ventas</h6>
                  <p class="summary-value">{{ daySummary.totalSales | currency }}</p>
                </div>
              </div>
              <div class="col-md-3">
                <div class="summary-card">
                  <h6>Facturas Pendientes</h6>
                  <p class="summary-value">{{ daySummary.pendingInvoices | currency }}</p>
                </div>
              </div>
              <div class="col-md-3">
                <div class="summary-card">
                  <h6>Total a Recibir</h6>
                  <p class="summary-value">{{ daySummary.totalToReceive | currency }}</p>
                </div>
              </div>
              <div class="col-md-3">
                <div class="summary-card">
                  <h6>Monto Entregado</h6>
                  <input
                    type="number"
                    class="form-control"
                    [(ngModel)]="daySummary.amountDelivered"
                    placeholder="0.00"
                    step="0.01"
                    min="0"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Formulario para Agregar Facturas -->
          <div class="add-invoice-form mb-4">
            <h5>Agregar Factura</h5>
            <form (ngSubmit)="addInvoice()" #invoiceForm="ngForm">
              <div class="row">
                <div class="col-md-3">
                  <input
                    type="text"
                    class="form-control"
                    [(ngModel)]="newInvoice.number"
                    name="number"
                    placeholder="Número de Factura"
                    required
                  />
                </div>
                <div class="col-md-3">
                  <input
                    type="number"
                    class="form-control"
                    [(ngModel)]="newInvoice.amount"
                    name="amount"
                    placeholder="Monto"
                    step="0.01"
                    min="0"
                    required
                  />
                </div>
                <div class="col-md-3">
                  <input
                    type="date"
                    class="form-control"
                    [(ngModel)]="newInvoice.date"
                    name="date"
                    required
                  />
                </div>
                <div class="col-md-2">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [(ngModel)]="newInvoice.isPaid"
                      name="isPaid"
                      id="isPaid"
                    />
                    <label class="form-check-label" for="isPaid"> Pagada </label>
                  </div>
                </div>
                <div class="col-md-1">
                  <button
                    type="submit"
                    class="btn btn-primary w-100"
                    [disabled]="!invoiceForm.form.valid"
                  >
                    Agregar
                  </button>
                </div>
              </div>
            </form>
          </div>

          <!-- Tabla de Facturas del Día -->
          <div class="day-invoices mb-4">
            <h5>Facturas del Día</h5>
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Número</th>
                    <th>Fecha</th>
                    <th>Monto</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let invoice of dayInvoices; let i = index">
                    <td>{{ invoice.number }}</td>
                    <td>{{ invoice.date | date : 'shortDate' }}</td>
                    <td>{{ invoice.amount | currency }}</td>
                    <td>
                      <span class="badge" [class]="invoice.isPaid ? 'bg-success' : 'bg-warning'">
                        {{ invoice.isPaid ? 'Pagada' : 'Pendiente' }}
                      </span>
                    </td>
                    <td>
                      <button class="btn btn-danger btn-sm" (click)="removeInvoice(i)">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Botón Finalizar Día -->
          <div class="finalize-day text-center">
            <button class="btn btn-primary btn-lg" (click)="finalizeDay()">
              <i class="fas fa-check"></i> Finalizar Día
            </button>
          </div>
        </div>
      </div>

      <!-- Pestaña Facturas -->
      <div *ngIf="activeTab === 'facturas'" class="tab-pane active">
        <h4>Facturas Pendientes - Próximamente</h4>
        <p>Gestión de facturas pendientes y pagos.</p>
      </div>
    </div>
  </div>
</div>
